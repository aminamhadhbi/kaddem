pipeline {
    agent any

    stages {
        stage('Checkout') {
            steps {
                // Récupérer le code depuis le référentiel Git
                git 'https://github.com/aminamhadhbi/kaddem.git'
            }
        }
 stage('Maven Clean') {
            steps {
                // Nettoyer le projet (mvn clean)
                sh 'mvn clean'
            }
        }

        stage('Maven Compile') {
            steps {
                // Compiler le projet (mvn compile)
                sh 'mvn compile'
            }
        }

    stage('SonarQube Analysis') {
            steps {
                    sh 'mvn sonar:sonar -Dsonar.login=admin -Dsonar.password=admin'
                }
          
        }

        stage('Build Artifact') {
            steps {
                script {
                    // Define the Maven tool (make sure it's configured in Jenkins)
                    def mvnTool = tool name: 'Maven', type: 'Tool'

                    // Set the Maven goals and options
                    def mavenGoals = 'clean package'
                    
                    // Run Maven to build the artifact
                    sh label: '', script: "${mvnTool}/bin/mvn ${mavenGoals}"
                }
            }
       
    }
    }
}

