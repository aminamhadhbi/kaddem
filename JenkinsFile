pipeline {
    agent any
    environment {
    registry = "aminamhadhbi/first"
    registryCredential = 'dockerHub'
    dockerImage = ''
    }
    stages {
        stage('Checkout') {
            steps {
                // Récupérer le code depuis le référentiel Git
                git 'https://github.com/aminamhadhbi/kaddem.git'
            }
        }
 stage('Maven Clean') {
            steps {
                // Nettoyer le projet (mvn clean)
                sh 'mvn clean'
            }
        }

        stage('Maven Compile') {
            steps {
                // Compiler le projet (mvn compile)
                sh 'mvn compile'
            }
        }
  
  //   stage("Deploy With Nexus") {
    //        steps {
      //        sh 'mvn clean deploy -DskipTests -Durl=http://192.168.33.10:8081/repository/maven-releases/'
        //    }
     //}



    //stage('SonarQube Analysis') {
      //      steps {
        //            sh 'mvn sonar:sonar -Dsonar.login=admin -Dsonar.password=admin'
          //      }
          
        //}
 //  stage('Build Artifact') {
            //steps {
              // Run Maven clean and package commands to build the .jar file.
          //      sh 'mvn clean package -DskipTests'
        //    }
      //  }
 stage('Building our image') {
            steps{
                 script {
                    dockerImage = docker.build registry + ":$BUILD_NUMBER"
                 }
            }
       }
stage('Deploy our image') {
             steps {
                  script {
                    // docker.withRegistry('https://registry.hub.docker.com') {
docker.withRegistry( '', registryCredential ) {
                    
dockerImage.push("${registry}:${BUILD_NUMBER}")

                    // docker.withRegistry( '', registryCredential ) {
                   //  dockerImage.push()
                      }
                  }
            }
       }
    }
}

